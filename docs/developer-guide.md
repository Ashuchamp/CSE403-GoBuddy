# Developer Guide

This guide provides comprehensive instructions for developers to obtain, build, test, and release the GoBuddy system.

---

## 1. Obtaining the Source Code

### Repository

**GitHub Repository:**  
```
https://github.com/Ashuchamp/CSE403-GoBuddy.git
```

GoBuddy uses a single repository (monorepo) with no submodules.

### Clone the Repository

```bash
git clone https://github.com/Ashuchamp/CSE403-GoBuddy.git
cd CSE403-GoBuddy
```

### Prerequisites

Ensure the following software is installed on your development machine:

| Software | Version | Purpose |
|----------|---------|---------|
| **Node.js** | v18.x or v20.x | JavaScript runtime for frontend and backend |
| **npm** | v9+ | Package manager (comes with Node.js) |
| **PostgreSQL** | v12+ | Database for backend |
| **Expo CLI** | Latest | React Native development (optional but recommended) |
| **iOS Development** | Xcode 14+ | For iOS builds (macOS only) |

**Verify installations:**

```bash
node -v    # Should show v18.x.x or v20.x.x
npm -v     # Should show 9.x.x or higher
psql --version  # Should show PostgreSQL 12 or higher
```

---

## 2. Directory Structure

GoBuddy is organized as a monorepo with separate frontend and backend directories.

```
CSE403-GoBuddy/
├── go-buddy/              # React Native (Expo) mobile application
│   ├── src/
│   │   ├── __tests__/     # Test files (*.test.tsx)
│   │   │   ├── components/  # Component tests
│   │   │   └── screens/     # Screen tests
│   │   ├── components/    # Reusable UI components
│   │   ├── screens/       # Main app screens
│   │   ├── navigation/    # Navigation configuration
│   │   ├── services/      # API client and external services
│   │   ├── utils/         # Utility functions
│   │   ├── types.ts       # TypeScript type definitions
│   │   └── theme.ts       # UI theme configuration
│   ├── assets/            # Images, icons, fonts
│   ├── ios/               # iOS native code and configuration
│   ├── app.json           # Expo configuration
│   ├── eas.json           # EAS Build configuration
│   ├── package.json       # Frontend dependencies
│   ├── tsconfig.json      # TypeScript configuration
│   └── jest.setup.js      # Jest test configuration
│
├── backend/               # Node.js/Express API server
│   ├── src/
│   │   ├── config/        # Database configuration
│   │   ├── controllers/   # Request handlers
│   │   ├── models/        # Sequelize ORM models
│   │   ├── routes/        # API route definitions
│   │   ├── utils/         # Helper functions
│   │   └── server.ts      # Express server entry point
│   ├── dist/              # Compiled JavaScript (generated by build)
│   ├── package.json       # Backend dependencies
│   ├── tsconfig.json      # TypeScript configuration
│   ├── setup.sh           # Automated setup script
│   ├── test-api.sh        # API testing script
│   └── render.yaml        # Render deployment configuration
│
├── docs/                  # Documentation
│   ├── developer-guide.md # This file
│   ├── user-manual.md     # End-user documentation
│   └── coding-guidelines.md # Code style standards
│
├── reports/               # Weekly progress reports
├── README.md              # Project overview
├── pre-pr-check.sh        # Pre-commit validation script
└── package.json           # Root-level workspace configuration
```

### Key Directory Purposes

- **Source Code**: `go-buddy/src/` (frontend), `backend/src/` (backend)
- **Tests**: `go-buddy/src/__tests__/` (frontend unit tests)
- **Documentation**: `docs/` (developer and user guides)
- **Configuration**: Root and subdirectory `package.json`, `tsconfig.json`, `app.json`, `eas.json`
- **Build Artifacts**: `backend/dist/` (TypeScript compilation output), `go-buddy/coverage/` (test coverage reports)

---

## 3. Building the Software

### 3.1 Install Dependencies

#### Root Dependencies (Optional)
```bash
npm install
```

#### Frontend Dependencies
```bash
# From project root
cd go-buddy

# Set up environment variables (required for Google Sign-In)
cp .env.example .env

# Install dependencies and run
npm install
npm start
```

#### Backend Dependencies
```bash
cd backend
npm install
```

### 3.2 Backend Build & Setup

#### Automated Setup (Recommended)

The `setup.sh` script automates database configuration:

```bash
cd backend
./setup.sh
```

This script:
- Verifies Node.js and PostgreSQL installations
- Installs npm dependencies
- Creates `.env` file from `.env.example`
- Auto-configures database credentials for macOS
- Prompts manual configuration for Linux/Windows

#### Manual Setup

1. **Copy environment template:**
   ```bash
   cd backend
   cp .env.example .env
   ```

2. **Edit `.env` file** with your database credentials:
   
   **macOS:**
   ```env
   DB_USER=<your-macos-username>
   DB_PASSWORD=
   DB_HOST=localhost
   DB_NAME=gobuddy
   DB_PORT=5432
   ```
   
   **Linux/Windows:**
   ```env
   DB_USER=postgres
   DB_PASSWORD=<your-postgres-password>
   DB_HOST=localhost
   DB_NAME=gobuddy
   DB_PORT=5432
   ```

3. **Create database:**
   ```bash
   createdb gobuddy
   ```
   If the command above doesn't work for you, please create database via PostgreSQL prompt(Windows User Recommended):

   1. Connect to psql: Find your PostgreSQL's **\bin\psql.exe** path and replace the example path    in this command.
   ```
   & "C:\Program Files\PostgreSQL\18\bin\psql.exe" -U postgres
   ```

   2. Enter the password you created when you're installing PostgreSQL
  
   3. Your are now in sql, copy and run this command
   ```sql
   CREATE DATABASE gobuddy;
   ```
   if succeed, you will see this line
   ```
   CREATE DATABASE
   ```
   4. Run this command to connect the database
   ```
   \c gobuddy
   ```
   If succeed, you will see this line
   ```
   You are now connected to database "gobuddy" as user "postgres".
   ```
   and you can quit sql mode by running this command after you see the message above:
   ```
   \q
   ```
4. **Build TypeScript:**
   ```bash
   npm run build
   ```
   
   This compiles `src/` → `dist/` directory.

5. **Start development server:**
   ```bash
   npm run dev
   ```
   
   Backend runs at `http://localhost:3000`

6. **Verify backend health:**
   ```bash
   curl http://localhost:3000/api/health
   ```
   
   Expected response: `{"status":"ok"}`

### 3.3 Frontend Build & Setup

1. **Navigate to frontend:**
   ```bash
   cd go-buddy
   ```

2. **Configure Google OAuth (Required for Authentication):**
   
   Copy the example environment file:
   ```bash
   cp .env.example .env
   ```
   
   The `.env.example` file contains:
   - iOS OAuth Client ID (already configured)
   - Backend API URL (optional, for local development)
   - Google Maps API Key (optional)
   
   No changes needed unless you want to test against a local backend.

3. **Start Expo development server:**
   ```bash
   npm start
   ```

4. **Run on iOS device/simulator:**
   - Press `i` → iOS Simulator (macOS only)
   - Scan QR code → Physical iOS device (requires Expo Go app)

---

## 4. Testing the Software

### 4.1 Full System Test (Recommended)

Run all checks before submitting a pull request:

```bash
# From project root
./pre-pr-check.sh
```

This script runs:
- ✅ TypeScript type checking (`npm run type-check`)
- ✅ ESLint validation (`npm run lint`)
- ✅ Prettier formatting check (`npm run format:check`)
- ✅ Frontend test suite with coverage (`npm run test:ci`)
- ✅ Backend linting (`npm run lint`)

### 4.2 Frontend Testing

#### Run All Tests
```bash
cd go-buddy
npm test
```

#### Watch Mode (Interactive)
```bash
npm run test:watch
```

#### Coverage Report
```bash
npm run test:coverage
```

Coverage reports are generated in `go-buddy/coverage/`:
- `lcov-report/index.html` - HTML coverage report
- `coverage-final.json` - JSON coverage data

**Coverage Requirements:**
- Statements: ≥ 80%
- Branches: ≥ 70%
- Functions: ≥ 80%
- Lines: ≥ 80%

#### CI Mode (Non-Interactive)
```bash
npm run test:ci
```

#### Type Checking
```bash
npm run type-check
```

#### Linting
```bash
npm run lint          # Check for issues
npm run lint:fix      # Auto-fix issues
```

#### Code Formatting
```bash
npm run format:check  # Check formatting
npm run format        # Auto-format code
```

### 4.3 Backend Testing

The backend uses manual API testing with curl/Postman.

#### Start Backend
```bash
cd backend
npm run dev
```

#### Health Check
```bash
curl http://localhost:3000/api/health
```

Expected response:
```json
{"status":"ok"}
```

#### Run Test Script
```bash
./test-api.sh
```

This script tests all API endpoints with sample requests.

#### Postman Collection

Import `backend/GoBuddy-API.postman_collection.json` into Postman for interactive API testing:
- Health check
- User operations (create, read, update, delete)
- Activity management
- Connection requests
- Notifications

---

## 5. Adding New Tests

### 5.1 Test Organization

| Test Type | Location | File Pattern | Framework |
|-----------|----------|--------------|-----------|
| Component Tests | `go-buddy/src/__tests__/components/` | `*.test.tsx` | Jest + React Testing Library |
| Screen Tests | `go-buddy/src/__tests__/screens/` | `*.test.tsx` | Jest + React Testing Library |

### 5.2 Naming Conventions

- **Test files must end with:** `.test.tsx` (React components) or `.test.ts` (utilities)
- **Test file name should match component name:**
  - Component: `Button.tsx` → Test: `Button.test.tsx`
  - Screen: `BrowseScreen.tsx` → Test: `BrowseScreen.test.tsx`
- **Test descriptions should be descriptive:**
  - ✅ Good: `"should call onPress when button is pressed"`
  - ❌ Bad: `"test button"`

### 5.3 Test Structure Example

#### Component Test Example

```typescript
// src/__tests__/components/Button.test.tsx
import React from 'react';
import {render, fireEvent} from '@testing-library/react-native';
import {Button} from '../../components/Button';

describe('Button Component', () => {
  it('should render with correct text', () => {
    const {getByText} = render(<Button>Click Me</Button>);
    expect(getByText('Click Me')).toBeTruthy();
  });

  it('should call onPress when pressed', () => {
    const onPressMock = jest.fn();
    const {getByText} = render(
      <Button onPress={onPressMock}>Click Me</Button>
    );
    
    fireEvent.press(getByText('Click Me'));
    expect(onPressMock).toHaveBeenCalledTimes(1);
  });

  it('should be disabled when loading', () => {
    const {getByText} = render(<Button loading>Submit</Button>);
    const button = getByText('Submit').parent;
    expect(button?.props.accessibilityState?.disabled).toBe(true);
  });
});
```

#### Screen Test Example

```typescript
// src/__tests__/screens/BrowseScreen.test.tsx
import React from 'react';
import {render, fireEvent, waitFor} from '@testing-library/react-native';
import {BrowseScreen} from '../../screens/BrowseScreen';
import {mockUsers, mockActivities} from '../mocks/data';

describe('BrowseScreen', () => {
  const defaultProps = {
    currentUser: mockUsers[0],
    activityIntents: mockActivities,
    activityRequests: [],
    onUserPress: jest.fn(),
    onJoinActivity: jest.fn(),
    onConnectRequest: jest.fn(),
  };

  it('should render search input', () => {
    const {getByPlaceholderText} = render(<BrowseScreen {...defaultProps} />);
    expect(getByPlaceholderText(/search/i)).toBeTruthy();
  });

  it('should switch between Users and Activities tabs', () => {
    const {getByText} = render(<BrowseScreen {...defaultProps} />);
    
    const activitiesTab = getByText('Activities');
    fireEvent.press(activitiesTab);
    
    expect(getByText('Discover activities to join')).toBeTruthy();
  });

  it('should filter results based on search query', async () => {
    const {getByPlaceholderText, queryByText} = render(
      <BrowseScreen {...defaultProps} />
    );
    
    const searchInput = getByPlaceholderText(/search/i);
    fireEvent.changeText(searchInput, 'Hiking');
    
    await waitFor(() => {
      expect(queryByText('Hiking')).toBeTruthy();
    });
  });
});
```

### 5.4 Running Specific Tests

```bash
# Run tests for specific file
npm test Button.test.tsx

# Run tests matching pattern
npm test -- --testNamePattern="should render"

# Run tests in specific directory
npm test -- components/
```

### 5.5 Test Utilities

GoBuddy uses:
- **Jest**: Test runner and assertion library
- **React Testing Library**: Component testing utilities
- **@testing-library/react-native**: React Native-specific utilities

Available in `jest.setup.js`:
- Console mocking (suppresses warnings in tests)
- Expo module mocks
- Test timeout: 10 seconds

---

## 6. Building a Release

### 6.1 Pre-Release Checklist

Before building a release, ensure:

1. ✅ **All tests pass:**
   ```bash
   ./pre-pr-check.sh
   ```

2. ✅ **Code is on `main` branch and up to date:**
   ```bash
   git checkout main
   git pull origin main
   ```

3. ✅ **All CI/CD checks pass on GitHub Actions**

4. ✅ **No uncommitted changes:**
   ```bash
   git status
   ```

### 6.2 Version Number Update

Update version numbers in the following files:

#### Frontend Version (`go-buddy/app.json`)
```json
{
  "expo": {
    "name": "GoBuddy",
    "version": "1.1.0",  // ← Update this
    "ios": {
      "buildNumber": "2"  // ← Increment this
    }
  }
}
```

#### Backend Version (`backend/package.json`)
```json
{
  "name": "gobuddy-backend",
  "version": "1.1.0",  // ← Update this
  ...
}
```

#### Root Version (`package.json`)
```json
{
  "name": "cse403-gobuddy",
  "version": "1.1.0",  // ← Update this
  ...
}
```

**Version Format:** Follow semantic versioning (MAJOR.MINOR.PATCH)
- **MAJOR**: Breaking changes
- **MINOR**: New features (backward compatible)
- **PATCH**: Bug fixes

### 6.3 Build Production Release

#### iOS Build (EAS)

```bash
cd go-buddy
eas build --platform ios --profile production
```

This creates a production iOS build and submits to App Store Connect for TestFlight distribution.

#### Backend Deployment

Backend auto-deploys to Render when code is pushed to `main` branch.

To trigger manual deployment:
```bash
cd backend
git push origin main
```

Render automatically:
- Installs dependencies (`npm install`)
- Builds TypeScript (`npm run build`)
- Starts server (`npm start`)

### 6.4 Commit and Tag Release

```bash
git add .
git commit -m "Release v1.1.0"
git tag -a v1.1.0 -m "Release version 1.1.0 - Added map feature"
git push origin main
git push origin v1.1.0
```

### 6.5 Post-Release Verification

#### Sanity Checks

1. **Backend Health Check:**
   ```bash
   curl https://gobuddy-backend-qvci.onrender.com/api/health
   ```
   Expected: `{"status":"ok"}`

2. **Mobile App Launch:**
   - Download build from TestFlight (iOS)
   - Verify app launches without crashes
   - Test critical flows:
     - Authentication (Google OAuth)
     - Browse activities
     - Create activity
     - Join activity
     - View recommendations
     - View map

3. **CI/CD Status:**
   - Check GitHub Actions: All workflows ✅ green
   - Check Render deployment logs: No errors

4. **User Testing:**
   - Share TestFlight link with beta testers
   - Monitor crash reports and feedback

### 6.6 Rollback Procedure

If critical issues are discovered post-release:

1. **Revert to previous tag:**
   ```bash
   git revert <commit-hash>
   git push origin main
   ```

2. **Redeploy previous version on Render:**
   - Manual rollback via Render dashboard
   - Or push previous commit to main

3. **Notify users via TestFlight release notes**

---

## Additional Resources

- **User Manual:** `docs/user-manual.md`
- **Coding Guidelines:** `docs/coding-guidelines.md`
- **API Documentation:** `backend/GoBuddy-API.postman_collection.json`

---

## Support

For questions or issues:
- **GitHub Issues:** https://github.com/Ashuchamp/CSE403-GoBuddy/issues
- **Bug Reports:** Use issue template `.github/ISSUE_TEMPLATE/bug_report.md`
- **Feature Requests:** Use issue template `.github/ISSUE_TEMPLATE/feature_request.md`

---

**Last Updated:** December 2024  

**Version:** 1.0.0

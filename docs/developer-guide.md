# Developer Guide

This guide provides comprehensive instructions for developers to obtain, build, test, and release the GoBuddy system.

---

## Quick Start

**Want to run the app immediately?** Here's all you need:

```bash
# Clone the repository
git clone https://github.com/Ashuchamp/CSE403-GoBuddy.git
cd CSE403-GoBuddy/go-buddy

# Set up environment variables (required for Google Sign-In)
cp .env.example .env

# Install dependencies and run
npm install
npm run ios
```

**That's it!** The app will build and launch on iOS Simulator, connecting to our production backend automatically.

**Prerequisites:**
- macOS (required for iOS Simulator)
- Node.js v18+ or v20+
- Xcode 14+ (for iOS Simulator)

**Note:** 
- `npm run ios` only works on macOS with Xcode installed
- Windows/Linux users: See section 4.2.1 for alternative testing methods using physical devices

For detailed setup, testing, and backend development, continue reading below.

---

## 1. Obtaining the Source Code

### Repository

**GitHub Repository:**  
```
https://github.com/Ashuchamp/CSE403-GoBuddy.git
```

GoBuddy uses a single repository (monorepo) with no submodules.

### Clone the Repository

```bash
git clone https://github.com/Ashuchamp/CSE403-GoBuddy.git
cd CSE403-GoBuddy
```

### Prerequisites

#### For macOS Development (iOS Simulator)

| Software | Version | Purpose |
|----------|---------|---------|
| **Node.js** | v18.x or v20.x | JavaScript runtime for frontend |
| **npm** | v9+ | Package manager (comes with Node.js) |
| **Xcode** | 14+ | For iOS Simulator |

**Verify installations:**

```bash
node -v    # Should show v18.x.x or v20.x.x
npm -v     # Should show 9.x.x or higher
xcodebuild -version  # Should show Xcode 14 or higher
```

#### For Windows/Linux Development (Physical Device)

| Software | Version | Purpose |
|----------|---------|---------|
| **Node.js** | v18.x or v20.x | JavaScript runtime for frontend |
| **npm** | v9+ | Package manager (comes with Node.js) |
| **EAS CLI** | Latest | For building iOS apps without macOS |
| **iOS Device** | iOS 13+ | Physical device for testing |

**Verify installations:**

```bash
node -v    # Should show v18.x.x or v20.x.x
npm -v     # Should show 9.x.x or higher
eas --version  # Should show latest EAS CLI version
```

See section 4.2.1 for instructions on testing with Windows/Linux.

#### Optional (for backend development only)

| Software | Version | Purpose |
|----------|---------|---------|
| **PostgreSQL** | v12+ | Local database for backend development |

---

## 2. Directory Structure

GoBuddy is organized as a monorepo with separate frontend and backend directories.

```
CSE403-GoBuddy/
├── go-buddy/              # React Native (Expo) mobile application
│   ├── src/
│   │   ├── __tests__/     # Test files (*.test.tsx)
│   │   │   ├── components/  # Component tests
│   │   │   └── screens/     # Screen tests
│   │   ├── components/    # Reusable UI components
│   │   ├── screens/       # Main app screens
│   │   ├── navigation/    # Navigation configuration
│   │   ├── services/      # API client and external services
│   │   ├── utils/         # Utility functions
│   │   ├── types.ts       # TypeScript type definitions
│   │   └── theme.ts       # UI theme configuration
│   ├── assets/            # Images, icons, fonts
│   ├── ios/               # iOS native code and configuration
│   ├── app.json           # Expo configuration
│   ├── eas.json           # EAS Build configuration
│   ├── package.json       # Frontend dependencies
│   ├── tsconfig.json      # TypeScript configuration
│   └── jest.setup.js      # Jest test configuration
│
├── backend/               # Node.js/Express API server
│   ├── src/
│   │   ├── config/        # Database configuration
│   │   ├── controllers/   # Request handlers
│   │   ├── models/        # Sequelize ORM models
│   │   ├── routes/        # API route definitions
│   │   ├── utils/         # Helper functions
│   │   └── server.ts      # Express server entry point
│   ├── dist/              # Compiled JavaScript (generated by build)
│   ├── package.json       # Backend dependencies
│   ├── tsconfig.json      # TypeScript configuration
│   ├── setup.sh           # Automated setup script
│   ├── test-api.sh        # API testing script
│   └── render.yaml        # Render deployment configuration
│
├── docs/                  # Documentation
│   ├── developer-guide.md # This file
│   ├── user-manual.md     # End-user documentation
│   └── coding-guidelines.md # Code style standards
│
├── reports/               # Weekly progress reports
├── README.md              # Project overview
├── pre-pr-check.sh        # Pre-commit validation script
└── package.json           # Root-level workspace configuration
```

### Key Directory Purposes

- **Source Code**: `go-buddy/src/` (frontend), `backend/src/` (backend)
- **Tests**: `go-buddy/src/__tests__/` (frontend unit tests)
- **Documentation**: `docs/` (developer and user guides)
- **Configuration**: Root and subdirectory `package.json`, `tsconfig.json`, `app.json`, `eas.json`
- **Build Artifacts**: `backend/dist/` (TypeScript compilation output), `go-buddy/coverage/` (test coverage reports)

---

## 3. Environment Configuration

### 3.1 Setting Up Environment Variables

The GoBuddy app requires certain environment variables to be configured for full functionality. A template file `.env.example` is provided in the `go-buddy` directory.

**To set up your environment:**

```bash
cd go-buddy
cp .env.example .env
```

The `.env.example` file contains the following pre-configured values:

| Variable | Required | Description | Default Value |
|----------|----------|-------------|---------------|
| `EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID` | **Yes** | Google OAuth Client ID for iOS authentication | Pre-configured for production |
| `EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID` | No | Google OAuth Client ID for Android (optional) | Empty |
| `EXPO_PUBLIC_GOOGLE_WEB_CLIENT_ID` | No | Google OAuth Client ID for Web (optional) | Empty |
| `EXPO_PUBLIC_GOOGLE_MAPS_API_KEY` | No | Google Maps API key for map features | Empty (maps will work with limited features) |
| `EXPO_PUBLIC_API_URL` | No | Backend API URL | Production backend (auto-configured) |
| `EXPO_PUBLIC_REVIEW_ACCESS_CODE` | No | Access code for App Store review mode | `GOBUDDY-REVIEW-2024` |

**Important Notes:**

- The **iOS Client ID is required** for Google Sign-In to work on iOS. The `.env.example` file includes a pre-configured client ID that works out of the box.
- The Google Maps API key is optional but recommended for full map functionality. See `GOOGLE_MAPS_SETUP.md` for instructions on obtaining your own API key.
- All other variables have sensible defaults and don't need to be changed for development.

---

## 4. Building the Software

### 4.1 Quick Start (Recommended)

The mobile app is pre-configured to connect to a hosted backend. No backend setup required!

```bash
# From project root
cd go-buddy

# Set up environment variables (required for Google Sign-In)
cp .env.example .env

# Install dependencies and run
npm install
npm run ios
```

This will:
- Configure Google OAuth for iOS authentication
- Install all frontend dependencies
- Build and launch the app on iOS Simulator
- Connect to the production backend hosted on Render

**That's it!** The app is ready to use.

**Requirements:**
- macOS with Xcode 14+ installed
- The app runs on iOS Simulator only via this method
- Windows/Linux users: See section 4.2.1 below

---

### 4.2 Advanced Setup

#### 4.2.1 Testing on Windows/Linux (Physical Device)

If you don't have access to macOS, you can test the app on a physical iOS device using one of these methods:

**Option A: Install Production Build (Recommended)**

Download and install the latest production build from TestFlight or the App Store:
- No development environment needed
- Fully functional app
- Best for testing user experience

**Option B: Create a Development Build**

1. **Install EAS CLI:**
   ```bash
   npm install -g eas-cli
   ```

2. **Login to Expo:**
   ```bash
   eas login
   ```

3. **Build a development client:**
   ```bash
   cd go-buddy
   eas build --profile development --platform ios
   ```

4. **Install the build on your iOS device:**
   - Download the .ipa file from the EAS build page
   - Install via TestFlight or direct installation

5. **Start the development server:**
   ```bash
   npm start
   ```

6. **Connect your device:**
   - Scan the QR code with the development client app

**Note:** The standard Expo Go app won't work because GoBuddy uses custom native modules (Google Sign-In, Maps, etc.).

#### 4.2.2 Local Backend Development (Optional)

Only follow these steps if you need to modify the backend or run it locally.

**Prerequisites:**
- PostgreSQL v12+ installed and running
- Node.js v18.x or v20.x

**Setup Steps:**

1. **Navigate to backend:**
   ```bash
   cd backend
   ```

2. **Install dependencies:**
   ```bash
   npm install
   ```

3. **Run automated setup:**
   ```bash
   ./setup.sh
   ```
   
   This script:
   - Verifies Node.js and PostgreSQL installations
   - Creates `.env` file from `.env.example`
   - Auto-configures database credentials for macOS
   - Prompts manual configuration for Linux/Windows

4. **Create database:**
   ```bash
   createdb gobuddy
   ```
   
   Or via PostgreSQL prompt:
   ```sql
   CREATE DATABASE gobuddy;
   ```

5. **Build and start backend:**
   ```bash
   npm run build
   npm run dev
   ```
   
   Backend runs at `http://localhost:3000`

6. **Configure frontend to use local backend:**
   
   Create or edit `go-buddy/.env`:
   ```env
   EXPO_PUBLIC_API_URL=http://localhost:3000/api
   ```

7. **Restart frontend:**
   ```bash
   cd go-buddy
   npm start
   ```

**Verify backend health:**
```bash
curl http://localhost:3000/api/health
```

Expected response: `{"status":"ok"}`

---

## 4. Testing the Software

### 4.1 Full System Test (Recommended)

Run all checks before submitting a pull request:

```bash
# From project root
./pre-pr-check.sh
```

This script runs:
- ✅ TypeScript type checking (`npm run type-check`)
- ✅ ESLint validation (`npm run lint`)
- ✅ Prettier formatting check (`npm run format:check`)
- ✅ Frontend test suite with coverage (`npm run test:ci`)
- ✅ Backend linting (`npm run lint`)

### 4.2 Frontend Testing

#### Run All Tests
```bash
cd go-buddy
npm test
```

#### Watch Mode (Interactive)
```bash
npm run test:watch
```

#### Coverage Report
```bash
npm run test:coverage
```

Coverage reports are generated in `go-buddy/coverage/`:
- `lcov-report/index.html` - HTML coverage report
- `coverage-final.json` - JSON coverage data

**Coverage Requirements:**
- Statements: ≥ 80%
- Branches: ≥ 70%
- Functions: ≥ 80%
- Lines: ≥ 80%

#### CI Mode (Non-Interactive)
```bash
npm run test:ci
```

#### Type Checking
```bash
npm run type-check
```

#### Linting
```bash
npm run lint          # Check for issues
npm run lint:fix      # Auto-fix issues
```

#### Code Formatting
```bash
npm run format:check  # Check formatting
npm run format        # Auto-format code
```

### 4.3 Backend Testing (Optional)

Backend testing is only needed if you're modifying backend code. The production backend is already deployed and tested.

#### Start Local Backend
```bash
cd backend
npm run dev
```

#### Health Check
```bash
# For production backend (always available)
curl https://gobuddy-backend-qvci.onrender.com/api/health

# For local backend (if running)
curl http://localhost:3000/api/health
```

Expected response:
```json
{"status":"ok"}
```

#### Run Test Script
```bash
cd backend
./test-api.sh
```

This script tests all API endpoints with sample requests.

#### Postman Collection

Import `backend/GoBuddy-API.postman_collection.json` into Postman for interactive API testing:
- Health check
- User operations (create, read, update, delete)
- Activity management
- Connection requests
- Notifications

---

## 5. Adding New Tests

### 5.1 Test Organization

| Test Type | Location | File Pattern | Framework |
|-----------|----------|--------------|-----------|
| Component Tests | `go-buddy/src/__tests__/components/` | `*.test.tsx` | Jest + React Testing Library |
| Screen Tests | `go-buddy/src/__tests__/screens/` | `*.test.tsx` | Jest + React Testing Library |

### 5.2 Naming Conventions

- **Test files must end with:** `.test.tsx` (React components) or `.test.ts` (utilities)
- **Test file name should match component name:**
  - Component: `Button.tsx` → Test: `Button.test.tsx`
  - Screen: `BrowseScreen.tsx` → Test: `BrowseScreen.test.tsx`
- **Test descriptions should be descriptive:**
  - ✅ Good: `"should call onPress when button is pressed"`
  - ❌ Bad: `"test button"`

### 5.3 Test Structure Example

#### Component Test Example

```typescript
// src/__tests__/components/Button.test.tsx
import React from 'react';
import {render, fireEvent} from '@testing-library/react-native';
import {Button} from '../../components/Button';

describe('Button Component', () => {
  it('should render with correct text', () => {
    const {getByText} = render(<Button>Click Me</Button>);
    expect(getByText('Click Me')).toBeTruthy();
  });

  it('should call onPress when pressed', () => {
    const onPressMock = jest.fn();
    const {getByText} = render(
      <Button onPress={onPressMock}>Click Me</Button>
    );
    
    fireEvent.press(getByText('Click Me'));
    expect(onPressMock).toHaveBeenCalledTimes(1);
  });

  it('should be disabled when loading', () => {
    const {getByText} = render(<Button loading>Submit</Button>);
    const button = getByText('Submit').parent;
    expect(button?.props.accessibilityState?.disabled).toBe(true);
  });
});
```

#### Screen Test Example

```typescript
// src/__tests__/screens/BrowseScreen.test.tsx
import React from 'react';
import {render, fireEvent, waitFor} from '@testing-library/react-native';
import {BrowseScreen} from '../../screens/BrowseScreen';
import {mockUsers, mockActivities} from '../mocks/data';

describe('BrowseScreen', () => {
  const defaultProps = {
    currentUser: mockUsers[0],
    activityIntents: mockActivities,
    activityRequests: [],
    onUserPress: jest.fn(),
    onJoinActivity: jest.fn(),
    onConnectRequest: jest.fn(),
  };

  it('should render search input', () => {
    const {getByPlaceholderText} = render(<BrowseScreen {...defaultProps} />);
    expect(getByPlaceholderText(/search/i)).toBeTruthy();
  });

  it('should switch between Users and Activities tabs', () => {
    const {getByText} = render(<BrowseScreen {...defaultProps} />);
    
    const activitiesTab = getByText('Activities');
    fireEvent.press(activitiesTab);
    
    expect(getByText('Discover activities to join')).toBeTruthy();
  });

  it('should filter results based on search query', async () => {
    const {getByPlaceholderText, queryByText} = render(
      <BrowseScreen {...defaultProps} />
    );
    
    const searchInput = getByPlaceholderText(/search/i);
    fireEvent.changeText(searchInput, 'Hiking');
    
    await waitFor(() => {
      expect(queryByText('Hiking')).toBeTruthy();
    });
  });
});
```

### 5.4 Running Specific Tests

```bash
# Run tests for specific file
npm test Button.test.tsx

# Run tests matching pattern
npm test -- --testNamePattern="should render"

# Run tests in specific directory
npm test -- components/
```

### 5.5 Test Utilities

GoBuddy uses:
- **Jest**: Test runner and assertion library
- **React Testing Library**: Component testing utilities
- **@testing-library/react-native**: React Native-specific utilities

Available in `jest.setup.js`:
- Console mocking (suppresses warnings in tests)
- Expo module mocks
- Test timeout: 10 seconds

---

## 6. Building a Release

### 6.1 Pre-Release Checklist

Before building a release, ensure:

1. ✅ **All tests pass:**
   ```bash
   ./pre-pr-check.sh
   ```

2. ✅ **Code is on `main` branch and up to date:**
   ```bash
   git checkout main
   git pull origin main
   ```

3. ✅ **All CI/CD checks pass on GitHub Actions**

4. ✅ **No uncommitted changes:**
   ```bash
   git status
   ```

### 6.2 Version Number Update

Update version numbers in the following files:

#### Frontend Version (`go-buddy/app.json`)
```json
{
  "expo": {
    "name": "GoBuddy",
    "version": "1.1.0",  // ← Update this
    "ios": {
      "buildNumber": "2"  // ← Increment this
    }
  }
}
```

#### Backend Version (`backend/package.json`)
```json
{
  "name": "gobuddy-backend",
  "version": "1.1.0",  // ← Update this
  ...
}
```

#### Root Version (`package.json`)
```json
{
  "name": "cse403-gobuddy",
  "version": "1.1.0",  // ← Update this
  ...
}
```

**Version Format:** Follow semantic versioning (MAJOR.MINOR.PATCH)
- **MAJOR**: Breaking changes
- **MINOR**: New features (backward compatible)
- **PATCH**: Bug fixes

### 6.3 Build Production Release

#### iOS Build (EAS)

```bash
cd go-buddy
eas build --platform ios --profile production
```

This creates a production iOS build and submits to App Store Connect for TestFlight distribution.

#### Backend Deployment

Backend auto-deploys to Render when code is pushed to `main` branch.

To trigger manual deployment:
```bash
cd backend
git push origin main
```

Render automatically:
- Installs dependencies (`npm install`)
- Builds TypeScript (`npm run build`)
- Starts server (`npm start`)

### 6.4 Commit and Tag Release

```bash
git add .
git commit -m "Release v1.1.0"
git tag -a v1.1.0 -m "Release version 1.1.0 - Added map feature"
git push origin main
git push origin v1.1.0
```

### 6.5 Post-Release Verification

#### Sanity Checks

1. **Backend Health Check:**
   ```bash
   curl https://gobuddy-backend-qvci.onrender.com/api/health
   ```
   Expected: `{"status":"ok"}`

2. **Mobile App Launch:**
   - Download build from TestFlight (iOS)
   - Verify app launches without crashes
   - Test critical flows:
     - Authentication (Google OAuth)
     - Browse activities
     - Create activity
     - Join activity
     - View recommendations
     - View map

3. **CI/CD Status:**
   - Check GitHub Actions: All workflows ✅ green
   - Check Render deployment logs: No errors

4. **User Testing:**
   - Share TestFlight link with beta testers
   - Monitor crash reports and feedback

### 6.6 Rollback Procedure

If critical issues are discovered post-release:

1. **Revert to previous tag:**
   ```bash
   git revert <commit-hash>
   git push origin main
   ```

2. **Redeploy previous version on Render:**
   - Manual rollback via Render dashboard
   - Or push previous commit to main

3. **Notify users via TestFlight release notes**

---

## Additional Resources

- **User Manual:** `docs/user-manual.md`
- **Coding Guidelines:** `docs/coding-guidelines.md`
- **API Documentation:** `backend/GoBuddy-API.postman_collection.json`

---

## Support

For questions or issues:
- **GitHub Issues:** https://github.com/Ashuchamp/CSE403-GoBuddy/issues
- **Bug Reports:** Use issue template `.github/ISSUE_TEMPLATE/bug_report.md`
- **Feature Requests:** Use issue template `.github/ISSUE_TEMPLATE/feature_request.md`

---

**Last Updated:** December 2024  
**Version:** 1.0.0